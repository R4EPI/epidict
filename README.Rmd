---
title: epidict
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/epidict)](https://CRAN.R-project.org/package=epidict)
[![Travis build status](https://travis-ci.org/R4EPI/epidict.svg?branch=master)](https://travis-ci.org/R4EPI/epidict)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/R4EPI/epidict?branch=master&svg=true)](https://ci.appveyor.com/project/R4EPI/epidict)
[![Codecov test coverage](https://codecov.io/gh/R4EPI/epidict/branch/master/graph/badge.svg)](https://codecov.io/gh/R4EPI/epidict?branch=master)
<!-- badges: end -->

The goal of {epidict} is to provide standardized data dictionaries for the MSF 
R4EPIs project. 

## Installation

To install a stable version of {epidict}, please use the R4epis repository:

```r
# install.packages("drat")
drat::addRepo("R4EPI")
install.packages("epidict")
```

## Accessing dictionaries

There are four MSF outbreak dictionaries available in {epidict}:

 - Cholera/Acute watery diarrhea ("cholera")
 - Meningitis
 - Measles/Rubella ("measles")
 - Acute Jaundice Syndrome (often suspected to be Hepatitis E) ("ajs")

> You can read more about the outbreak dictionaries at <https://r4epis.netlify.com/outbreaks>

The dictionary can be obtained via the `msf_dict()` function, which specifies a
dictionary that describes recorded variables (`data_element_shortname`) in rows
and their possible options (if categorical):

```{r outbreak}
library("epidict")
msf_dict("Measles", compact = FALSE)
msf_dict("AJS", compact = FALSE)
msf_dict("Cholera", compact = FALSE)
msf_dict("Meningitis", compact = FALSE)
```

In addition, there are three MSF survey dictionaries available:

 - Retrospective mortality and access to care ("mortality")
 - Malnutrition ("nutrition") 
 - Vaccination Coverage ("vaccination")

> You can read more about the survey dictionaries at <https://r4epis.netlify.com/surveys>

These are accessible via `msf_dict_survey()` where the variables are in 
`column_name` and are often labeled by question number. 

```{r survey}
msf_dict_survey("Mortality", compact = FALSE)
msf_dict_survey("Nutrition", compact = FALSE)
msf_dict_survey("Vaccination", compact = FALSE)
```

## Generating data

The {epidict} package has a function for generating data that's called
`gen_data()`, which takes three arguments: The dictionary, which column
describes the variable names, and how many rows are needed in the output.

```{r gendata}
gen_data("Measles", varnames = "data_element_shortname", numcases = 100, org = "MSF")
gen_data("Vaccination", varnames = "column_name", numcases = 100, org = "MSF")
```

## Cleaning data with the dictionaries

You can use the dictionaries to clean the data via the [{matchmaker}](https://www.repidemicsconsortium.org/matchmaker) package:

```{r lookup, message = FALSE}
library("matchmaker")
library("dplyr")

dat <- gen_data(dictionary = "Cholera", 
  varnames = "data_element_shortname",
  numcases = 20,
  org = "MSF"
)
print(dat)

# We want the expanded dictionary, so we will select `compact = FALSE`
dict <- msf_dict(disease = "Cholera", 
  long = TRUE, 
  compact = FALSE, 
  tibble = TRUE
)
print(dict)

# We can use linelist's clean_variable_spelling to translate the codes. First,
# we want to reorder the columns of the dictionary like so:
#
#  - 1st column: option codes
#  - 2nd column: translations
#  - 3rd column: data column name
#  - 4th column: order of options

# Now we can use linelist to filter the data:
dat_clean <- matchmaker::match_df(dat, dict, 
  from  = "option_code",
  to    = "option_name",
  by    = "data_element_shortname",
  order = "option_order_in_set"
)
print(dat_clean)
```

